import{_ as i,c as a,o as t,ae as e}from"./chunks/framework.BR0IJ75L.js";const g=JSON.parse('{"title":"MyBatis-Plus 核心使用","description":"","frontmatter":{},"headers":[],"relativePath":"notes_core/架构部分/MaBits-Plus.md","filePath":"notes_core/架构部分/MaBits-Plus.md"}'),n={name:"notes_core/架构部分/MaBits-Plus.md"};function l(h,s,p,k,r,d){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="mybatis-plus-核心使用" tabindex="-1">MyBatis-Plus 核心使用 <a class="header-anchor" href="#mybatis-plus-核心使用" aria-label="Permalink to &quot;MyBatis-Plus 核心使用&quot;">​</a></h1><h1 id="mybatis-plus-核心使用笔记" tabindex="-1">MyBatis-Plus 核心使用笔记 <a class="header-anchor" href="#mybatis-plus-核心使用笔记" aria-label="Permalink to &quot;MyBatis-Plus 核心使用笔记&quot;">​</a></h1><p>MyBatis-Plus（简称 MP）是 MyBatis 的增强工具，<strong>无侵入式</strong>扩展 MyBatis 功能，旨在简化开发流程、提高开发效率。核心支持 CRUD 接口封装、Lambda 条件查询、查询投影、字段/表名映射、乐观锁等实用功能，无需手动编写大量 XML 或 SQL 语句。</p><h2 id="一、核心特性与基础依赖" tabindex="-1">一、核心特性与基础依赖 <a class="header-anchor" href="#一、核心特性与基础依赖" aria-label="Permalink to &quot;一、核心特性与基础依赖&quot;">​</a></h2><h3 id="_1-核心优势" tabindex="-1">1. 核心优势 <a class="header-anchor" href="#_1-核心优势" aria-label="Permalink to &quot;1. 核心优势&quot;">​</a></h3><ul><li>无侵入：完全基于 MyBatis 扩展，不改变原有 MyBatis 用法</li><li>内置 CRUD：BaseMapper 接口封装常用操作，直接继承即可使用</li><li>支持 Lambda：避免硬编码字段名，减少拼写错误</li><li>功能丰富：条件查询、查询投影、乐观锁、字段映射等一站式支持</li></ul><h3 id="_2-基础准备" tabindex="-1">2. 基础准备 <a class="header-anchor" href="#_2-基础准备" aria-label="Permalink to &quot;2. 基础准备&quot;">​</a></h3><ul><li>实体类需与数据库表对应（支持注解映射）</li><li>Mapper 接口继承 <code>BaseMapper&lt;T&gt;</code>（T 为实体类）</li><li>配置 MP 核心依赖（Maven/Gradle）及拦截器（如乐观锁）</li></ul><h2 id="二、内置-crud-操作-basemapper-核心方法" tabindex="-1">二、内置 CRUD 操作（BaseMapper 核心方法） <a class="header-anchor" href="#二、内置-crud-操作-basemapper-核心方法" aria-label="Permalink to &quot;二、内置 CRUD 操作（BaseMapper 核心方法）&quot;">​</a></h2><p>Mapper 接口继承 <code>BaseMapper&lt;T&gt;</code> 后，直接调用以下内置方法，无需手动编写 SQL：</p><table tabindex="0"><thead><tr><th>方法名</th><th>功能描述</th><th>示例调用</th></tr></thead><tbody><tr><td><code>int insert(T entity)</code></td><td>新增一条记录</td><td><code>userMapper.insert(new User(&quot;张三&quot;, 20))</code></td></tr><tr><td><code>int updateById(T entity)</code></td><td>根据 ID 更新记录（非 null 字段才更新）</td><td><code>userMapper.updateById(new User(1L, &quot;李四&quot;, 22))</code></td></tr><tr><td><code>T selectById(Serializable id)</code></td><td>根据 ID 查询单条记录</td><td><code>User user = userMapper.selectById(1L)</code></td></tr><tr><td><code>int deleteById(Serializable id)</code></td><td>根据 ID 删除记录</td><td><code>userMapper.deleteById(1L)</code></td></tr><tr><td><code>List&lt;T&gt; selectList(Wrapper&lt;T&gt; queryWrapper)</code></td><td>条件查询列表</td><td>见「条件查询」章节</td></tr><tr><td><code>IPage&lt;T&gt; selectPage(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</code></td><td>分页查询</td><td><code>IPage&lt;User&gt; page = userMapper.selectPage(new Page&lt;&gt;(1,10), qw)</code></td></tr></tbody></table><h2 id="三、条件查询-wrapper-用法" tabindex="-1">三、条件查询（Wrapper 用法） <a class="header-anchor" href="#三、条件查询-wrapper-用法" aria-label="Permalink to &quot;三、条件查询（Wrapper 用法）&quot;">​</a></h2><p>MP 提供 <code>QueryWrapper</code>（普通格式）和 <code>LambdaQueryWrapper</code>（Lambda 格式），用于构造查询条件，避免硬编码字段名。</p><h3 id="_1-三种使用格式" tabindex="-1">1. 三种使用格式 <a class="header-anchor" href="#_1-三种使用格式" aria-label="Permalink to &quot;1. 三种使用格式&quot;">​</a></h3><h4 id="_1-普通-querywrapper-硬编码字段名" tabindex="-1">（1）普通 QueryWrapper（硬编码字段名） <a class="header-anchor" href="#_1-普通-querywrapper-硬编码字段名" aria-label="Permalink to &quot;（1）普通 QueryWrapper（硬编码字段名）&quot;">​</a></h4><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 构造条件：id = 1 且 username 包含 &quot;张&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">QueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; qw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryWrapper&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qw.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 等于</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">like</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;张&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 模糊查询</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; userList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(qw);</span></span></code></pre></div><h4 id="_2-querywrapper-lambda-避免硬编码" tabindex="-1">（2）QueryWrapper + Lambda（避免硬编码） <a class="header-anchor" href="#_2-querywrapper-lambda-避免硬编码" aria-label="Permalink to &quot;（2）QueryWrapper + Lambda（避免硬编码）&quot;">​</a></h4><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">QueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; qw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryWrapper&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用 lambda() 方法切换为 Lambda 模式，直接引用实体类方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qw.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getId, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">like</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getUsername, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;张&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; userList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(qw);</span></span></code></pre></div><h4 id="_3-lambdaquerywrapper-推荐-直接-lambda-格式" tabindex="-1">（3）LambdaQueryWrapper（推荐，直接 Lambda 格式） <a class="header-anchor" href="#_3-lambdaquerywrapper-推荐-直接-lambda-格式" aria-label="Permalink to &quot;（3）LambdaQueryWrapper（推荐，直接 Lambda 格式）&quot;">​</a></h4><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 直接创建 Lambda 格式 Wrapper，无需调用 lambda() 方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LambdaQueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; lqw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LambdaQueryWrapper&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lqw.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getId, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">like</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getUsername, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;张&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; userList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lqw);</span></span></code></pre></div><h3 id="_2-空值处理-避免条件失效" tabindex="-1">2. 空值处理（避免条件失效） <a class="header-anchor" href="#_2-空值处理-避免条件失效" aria-label="Permalink to &quot;2. 空值处理（避免条件失效）&quot;">​</a></h3><p>使用 <code>lt</code>/<code>gt</code>/<code>eq</code> 等方法的<strong>三参数重载</strong>，第一个参数为「条件是否成立」，实现空值过滤：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Integer minAge </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LambdaQueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; lqw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LambdaQueryWrapper&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当 minAge 不为 null 时，才添加 &quot;age &gt; minAge&quot; 条件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lqw.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(minAge </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getAge, minAge);</span></span></code></pre></div><h3 id="_3-常用条件方法" tabindex="-1">3. 常用条件方法 <a class="header-anchor" href="#_3-常用条件方法" aria-label="Permalink to &quot;3. 常用条件方法&quot;">​</a></h3><table tabindex="0"><thead><tr><th>方法名</th><th>功能描述</th><th>示例（Lambda 格式）</th></tr></thead><tbody><tr><td><code>eq</code></td><td>等于</td><td><code>lqw.eq(User::getId, 1L)</code></td></tr><tr><td><code>ne</code></td><td>不等于</td><td><code>lqw.ne(User::getUsername, &quot;admin&quot;)</code></td></tr><tr><td><code>like</code></td><td>模糊查询（%值%）</td><td><code>lqw.like(User::getUsername, &quot;张&quot;)</code></td></tr><tr><td><code>likeLeft</code></td><td>左模糊（%值）</td><td><code>lqw.likeLeft(User::getUsername, &quot;张&quot;)</code></td></tr><tr><td><code>likeRight</code></td><td>右模糊（值%）</td><td><code>lqw.likeRight(User::getUsername, &quot;张&quot;)</code></td></tr><tr><td><code>gt</code>/<code>lt</code></td><td>大于/小于</td><td><code>lqw.gt(User::getAge, 18)</code></td></tr><tr><td><code>ge</code>/<code>le</code></td><td>大于等于/小于等于</td><td><code>lqw.ge(User::getAge, 18)</code></td></tr><tr><td><code>in</code></td><td>包含</td><td><code>lqw.in(User::getId, 1L, 2L, 3L)</code></td></tr><tr><td><code>isNull</code></td><td>字段为空</td><td><code>lqw.isNull(User::getEmail)</code></td></tr><tr><td><code>orderByAsc</code></td><td>升序排序</td><td><code>lqw.orderByAsc(User::getAge)</code></td></tr></tbody></table><h2 id="四、查询投影-字段筛选" tabindex="-1">四、查询投影（字段筛选） <a class="header-anchor" href="#四、查询投影-字段筛选" aria-label="Permalink to &quot;四、查询投影（字段筛选）&quot;">​</a></h2><p>控制查询返回的字段（避免查询所有字段），支持指定字段、别名。</p><h3 id="_1-lambda-格式-推荐" tabindex="-1">1. Lambda 格式（推荐） <a class="header-anchor" href="#_1-lambda-格式-推荐" aria-label="Permalink to &quot;1. Lambda 格式（推荐）&quot;">​</a></h3><p>使用 <code>select</code> 方法传入实体类方法引用，指定需要查询的字段：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LambdaQueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; lqw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LambdaQueryWrapper&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 只查询 id 和 username 字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lqw.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getId, User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getUsername);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; userList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lqw);</span></span></code></pre></div><h3 id="_2-普通格式-硬编码字段名" tabindex="-1">2. 普通格式（硬编码字段名） <a class="header-anchor" href="#_2-普通格式-硬编码字段名" aria-label="Permalink to &quot;2. 普通格式（硬编码字段名）&quot;">​</a></h3><p>直接传入字段名字符串，支持用 <code>as</code> 指定别名：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">QueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; qw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryWrapper&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 查询 id（别名 uid）和 username（别名 uname）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qw.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id as uid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username as uname&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List&lt;Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; userMapList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectMaps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(qw);</span></span></code></pre></div><h2 id="五、字段-表名映射-解决不一致问题" tabindex="-1">五、字段/表名映射（解决不一致问题） <a class="header-anchor" href="#五、字段-表名映射-解决不一致问题" aria-label="Permalink to &quot;五、字段/表名映射（解决不一致问题）&quot;">​</a></h2><p>当实体类与数据库表、字段名不一致时，使用 MP 注解进行映射。</p><h3 id="_1-表名映射-类名-表名" tabindex="-1">1. 表名映射（类名 ≠ 表名） <a class="header-anchor" href="#_1-表名映射-类名-表名" aria-label="Permalink to &quot;1. 表名映射（类名 ≠ 表名）&quot;">​</a></h3><p>用 <code>@TableName</code> 注解指定数据库表名：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 实体类名 User → 数据库表名 t_user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TableName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;t_user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... 字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-字段名映射-变量名-字段名" tabindex="-1">2. 字段名映射（变量名 ≠ 字段名） <a class="header-anchor" href="#_2-字段名映射-变量名-字段名" aria-label="Permalink to &quot;2. 字段名映射（变量名 ≠ 字段名）&quot;">​</a></h3><p>用 <code>@TableField(value = &quot;数据库字段名&quot;)</code> 映射字段，支持别名：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 实体变量名 userId → 数据库字段名 user_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TableField</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long userId;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 字段别名（查询时用别名，数据库实际字段名仍为 username）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TableField</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">column</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;uname&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String username;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-忽略数据库不存在的字段" tabindex="-1">3. 忽略数据库不存在的字段 <a class="header-anchor" href="#_3-忽略数据库不存在的字段" aria-label="Permalink to &quot;3. 忽略数据库不存在的字段&quot;">​</a></h3><p>实体类中存在数据库表没有的字段时，用 <code>@TableField(exist = false)</code> 忽略：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long id;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String username;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 该字段仅用于内存计算，数据库中不存在</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TableField</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exist</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String tempValue;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_4-忽略查询时的保密字段" tabindex="-1">4. 忽略查询时的保密字段 <a class="header-anchor" href="#_4-忽略查询时的保密字段" aria-label="Permalink to &quot;4. 忽略查询时的保密字段&quot;">​</a></h3><p>敏感字段（如密码）不需要查询返回时，用 <code>@TableField(select = false)</code> 忽略：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long id;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String username;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 查询时默认不返回 password 字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TableField</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String password;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="六、乐观锁-解决多线程并发问题" tabindex="-1">六、乐观锁（解决多线程并发问题） <a class="header-anchor" href="#六、乐观锁-解决多线程并发问题" aria-label="Permalink to &quot;六、乐观锁（解决多线程并发问题）&quot;">​</a></h2><p>乐观锁基于「版本号」机制，避免并发更新时的数据覆盖，MP 提供注解 + 拦截器一键实现。</p><h3 id="_1-实现步骤" tabindex="-1">1. 实现步骤 <a class="header-anchor" href="#_1-实现步骤" aria-label="Permalink to &quot;1. 实现步骤&quot;">​</a></h3><h4 id="_1-数据库表添加版本字段" tabindex="-1">（1）数据库表添加版本字段 <a class="header-anchor" href="#_1-数据库表添加版本字段" aria-label="Permalink to &quot;（1）数据库表添加版本字段&quot;">​</a></h4><p>在表中新增 <code>version</code> 字段（int 类型，默认值 1）：</p><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;乐观锁版本号&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="_2-实体类添加版本字段并加注解" tabindex="-1">（2）实体类添加版本字段并加注解 <a class="header-anchor" href="#_2-实体类添加版本字段并加注解" aria-label="Permalink to &quot;（2）实体类添加版本字段并加注解&quot;">​</a></h4><p>用 <code>@Version</code> 注解标记版本字段：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long id;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String username;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 乐观锁版本字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Version</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer version;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_3-配置乐观锁拦截器" tabindex="-1">（3）配置乐观锁拦截器 <a class="header-anchor" href="#_3-配置乐观锁拦截器" aria-label="Permalink to &quot;（3）配置乐观锁拦截器&quot;">​</a></h4><p>在 MP 配置类中注册乐观锁拦截器（Spring Boot 示例）：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyBatisPlusConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 注册乐观锁拦截器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MybatisPlusInterceptor </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mybatisPlusInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        MybatisPlusInterceptor interceptor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MybatisPlusInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        interceptor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addInnerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OptimisticLockerInnerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> interceptor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-工作原理" tabindex="-1">2. 工作原理 <a class="header-anchor" href="#_2-工作原理" aria-label="Permalink to &quot;2. 工作原理&quot;">​</a></h3><ol><li>线程 1 查询数据时，获取当前版本号 <code>version = 1</code>；</li><li>线程 1 执行更新操作，MP 自动拼接 SQL：<code>UPDATE t_user SET ..., version = 2 WHERE id = ? AND version = 1</code>；</li><li>若线程 2 同时更新该数据，其查询的版本号仍为 1，但此时数据库中 version 已被线程 1 改为 2，线程 2 的更新 SQL 因 <code>version = 1</code> 不成立而执行失败；</li><li>线程 2 需重新查询最新数据（获取 version = 2），再次尝试更新。</li></ol><h3 id="_3-调用方式" tabindex="-1">3. 调用方式 <a class="header-anchor" href="#_3-调用方式" aria-label="Permalink to &quot;3. 调用方式&quot;">​</a></h3><p>直接调用 <code>updateById</code> 方法即可，MP 自动处理版本号：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. 查询最新数据（获取当前 version = 1）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">User user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. 修改字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUsername</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;李四&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. 自动触发乐观锁机制，版本号自增</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user);</span></span></code></pre></div>`,64)])])}const o=i(n,[["render",l]]);export{g as __pageData,o as default};
